# issue サーバ側だけで動くdemo interactive modeを実装し、インタラクティブモードのバグを修正する #99
[issues #99](https://github.com/cat2151/ym2151-log-play-server/issues/99)

# 補足
- インタラクティブモード（仮）とは
    - 概要
        - 演奏を続けながら
            - jsonを受信して演奏ができる
                - インタラクティブな用途に向くモード
    - これまでの課題
        - jsonを受信するごとにstop、無音、演奏開始
            - キーリピートでjson送信を続けるとずっと無音になるレベル
                - ほしいもの
                    - もっとインタラクティブに音を出したい
    - インタラクティブモード（仮）が解決すること
        - 無音
            - 実現すれば、頻繁にjsonを送信しても、
                - 無音にならず演奏を継続しながら音が鳴らせる
        - 可能性
            - 場合によっては、動的なシーケンス演奏も可能になるかもしれない
                - ライブ
                - ※検証次第
                - ※できない可能性もある
- 作る
    - 比較用、ヒント用に、demo non-interactive も作る
# 実装を着手し、調査した
# 結果
- 分析
    - インタラクティブモード全般に、多数の考慮漏れと実装誤り、ハルシネーションがみられた
        - ハルシネーション対象ざっくり
            - アーキテクチャ
                - データ設計
                    - データフォーマット
                - スケジューリング設計
- どうする？
    - 調査が必要
        - verbose log で可視化が必要
# 対策
- server demo interactive をverboseで動かし、logを充実させ、調査
# 結果
- delay
    - 同一時刻レジスタ書き込み時の2sample delayの考慮漏れ
        - これが音が鳴らない原因
- 遅延
    - バッファサイズがagent提唱のものが極端に大きく、400msの未来オフセットがないと、
        - 遅延（過去を演奏するようスケジュールしてしまい、実際に演奏するタイミングが遅延）
        - が発生してしまい、
        - 遅延eventが連続するため、同一時刻レジスタ書き込み時の2sample delayの漏れと
            - 合わさって、
            - 無音になっていた
# close条件
- server --demo-non-interactive が鳴ること
- server --demo-interactive が鳴ること
- 未来オフセットが適切に指定されることで、
    - 遅延（過去を演奏するようスケジュールしてしまい、実際に演奏するタイミングが遅延）
    - を防止し、
    - それによって、同一時刻レジスタ書き込みを防止し、
    - 音が鳴るようにすること
# closeとする
