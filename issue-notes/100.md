# issue 同一時刻レジスタ書き込み時の2sample delay を最終段でのみ行う #100
[issues #100](https://github.com/cat2151/ym2151-log-play-server/issues/100)

# issue実施の優先度は？
- 2025/11/20断面のissueのなかでは、最優先
- 理由、これが、[issues #101](https://github.com/cat2151/ym2151-log-play-server/issues/101) addr data pair形式の前提となる
    - クリティカルパスである
# メリット
- 途中の段がシンプルになる
    - どこでdelayをかけるか悩む必要がない
- 音が鳴ることが保証できる
    - これまで、これが原因で音が鳴らない、というトラブルが多数発生していた
- 過去の時刻に鳴らすようなスケジュールが発生したとき、
    - の対策にもなる
    - これまでの課題
        - この遅延（過去の時刻に鳴らすスケジュール = 演奏タイミングがスケジュールより遅延）
            - が発生すると、
            - 同一タイミングでのレジスタ書き込みが発生するので、
                - 音が鳴らなくなる
                - 原因がわかるまで時間がかかった
    - この遅延は、よく発生しうる。未来オフセット30msなどの値を減らすほど発生しやすい。
        - 値を増やすとそのぶん操作から聴こえるまでのラグが大きくなってしまう
- ミス防止
    - これまでの課題
        - delayをかける責務が分散していた
            - 新機能や新ルート追加時、delay処理漏れがあったとき、根深いトラブルの原因となった
                - 原因がわかるまで時間がかかった
- 安全
    - 最終段で確実にdelayがかかることが担保されている
# close条件
- 最終段のみに、2sample delayが実装されること
- これまであった2sample delay処理が削除されること
